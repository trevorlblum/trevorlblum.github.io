<!DOCTYPE html>
<!-- 
22/3/2025 update roche ref and strip nitrites
21/3/2025 some tidying of displays, adjusting tlc's and added x spacing param
20/3/2025 compare tlc's need fixing for combur and siemens-done for siemens and livingstone
20/3/2025 compare needs to be called when manufacture is known. Combur is 9 items, so compare fails on fixed 10.
18/3/2025 Roche tlc dies on fixed 10 for matches-WIP
17/3/2025 test strip displays need to be uniform size and position for pick and match.
17/3/2025 fixed pick by setting ondragstart NOT click for canvasstrip
17/3/2025 does invoke pick function during drag and drop from test strip (dropend nor click)
16/3/2025 some canvas name changes for easier identification of origins
NOTE: Reference image name from "Combur,9,5,50,50,60,70","Livingstone,10,7,35,40,65,70","Siemens,10,7,45,28,65,70"
In test_profiles.txt as ref_image_src[].

4/3/2025 test_profiles now comes from test_profiles.txt and reference images from reference_images/. Works but needs some tweaking for various test sets.

<html
><title> Multitest local  22/3</title>
<head>
	<!-- Load plotly.js into the DOM -->
	<script src='plotly.js'></script>
        <body onload="loaded()" id="body"></body>
        <script src='diag_notes.txt'></script>
        <script src='test_profiles.txt'></script>
        <script src='Multifunctions.txt'></script>
</head>

<body >

<h4 id="notice" >...Displaying mid-strip comparison 22/03/2025 NOTE: can only run from server localhost or trevorblum.name</H4>
<canvas id="canvasstrip" width="50px" height="875px" draggable="true" ondragstart="pick(event)" ></canvas>
<canvas id="canvasref" width="780px" height="880px" ondrop="dropit(event)" ondragover="allowDrop(event)"></canvas>
<div id="plotly" style="width:800px;height:450px;"></div>

<p id="hovered-color"</p>
<p id="selected-color"</p>

<p id="notes"></p> 
<style>
.diagzone {
        width: 800px;
        height: 200px;
        top:100px;
        left:100px;
        margin-bottom: 20px;
        background: yellow;
}
.dropzone {
  width: 600px;
  height: 200px;
  background: orange;
  margin: 10px;
  padding: 10px;
}
.Plotzone {
  left:400px;
  width: 600px;
  height: 200px;
  margin: 10px;
  padding: 10px;
}

</style>
<div class="diagzone" id="diagzone"></div>
<div class="dropzone" id="dropzone"></div>
<div class="Plotzone" id="plotzone"></div>

</body id="body">

<script>
//============================script begins here ====================

test_ID=["Combur","Siemens","Livingstone"];

test_num=1;//Combur=0,Siemens=1,Livingstone=2 //siemens and livingstone swapped???

//alert("test name_list "+namelist[test_num]);

//alert("Test_profiles.txt"+multi_test+" reference image "+ref_image_src);
//from test_profiles.txt get multi_test, namelist and multi_tlc
testvalues=multi_test[test_num].split(","); 
Manufacturer=testvalues[0];
ntests=testvalues[1];
nvalues=testvalues[2];
spotX=testvalues[3];
spotY=testvalues[4];
islandX=testvalues[5];
islandY=testvalues[6];
test_names=namelist[test_num];
document.getElementById("notice").innerHTML+=" chosen test is "+test_ID[test_num]+"<br>";
//alert("test names "+test_ID[test_num]);
diagvalues=diags[test_num];
image_names=ref_image_src;
space=refspacing[test_num];
count=numoftests[test_num];
//alert(" count "+count+" multi_tlc[test_num] "+multi_tlc[0]);
//get diagvalues from test_profiles
//alert(diagvalues);

//alert("first test name of "+test_names.length+" names "+test_names[0]+" Image name "+image_names[test_num]);

matches=[];
for(t=0;t<ntests;t++){
   matches[t]=[];
       for(r=0;r<nvalues;r++)matches[t][r]=t+r*nvalues;
}
//document.getElementById("body").innerHTML+=matches;
minmatch=[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0];

document.getElementById("dropzone").innerHTML="//dropzone";

//strip legends array is 8 wide( by 10 deep

//need to base spacings on multi-test data,eg yoffset,spotX,spotY,yoffset,spotX+islandX*i,spotY+islandY*i
//but reference pages are not evenly spaced.

// top left corners on reference canvas's from test_profiles.txt

tlc=multi_tlc[test_num];

const shownotes=true;

var rgbColor;
var dropcolour;
var pickcolour;
const hoveredColor = document.getElementById("hovered-color");
const selectedColor = document.getElementById("selected-color");// 

const canvasstrip = document.getElementById("canvasstrip");//canvasstrip shows picked colour for drag/drop
//canvasstrip.addEventListener("click", (event) => pick(event, selectedColor));
//canvasstrip.addEventListener( "dragend",(event)=>{event.preventDefault()});


const canvasref=document.getElementById("canvasref");
canvasref.addEventListener("click", (event) => showconfirm(event));
canvasref.addEventListener("drop", (event) => {
  // prevent default action (open as a link for some elements)
  event.preventDefault();
  // move dragged element to the selected drop target
  if (event.target.className === "dropzone") {
    dragged.parentNode.removeChild(dragged);
    event.target.appendChild(dragged);
  }
});

const ctxstrip = canvasstrip.getContext("2d");
//ctxstrip.fillStyle="orange";
//ctxstrip.fillRect(0,0,50,850);

stripimage=new Image();
stripimagesources=["roche test strips/Roche_central.png","siemens test strips/siemens_max.png","livingstone test strip/strips/one_strip_max.png"];
//alert("Strip png "+stripimagesources[test_num]); 
stripimage.src=stripimagesources[test_num];
ctxstrip.drawImage(stripimage, 0, 0);

//const canvasref = document.getElementById("canvasref");//canvasref shows reference image
const ctxref = canvasref.getContext("2d");
//ctxref.fillStyle="yellow";
//ctxref.fillRect(0,0,650,850);
refimage=new Image();
refimage.src=image_names[test_num];         //modified for multi-tests (Combur...)

ctxref.drawImage(refimage, 0, 0);
//draw diagvalues at tlc positions
//for(i=0;i<diagvalues.length;i++)ctxref.fillText(diagvalues[i],tlc[i*2],tlc[i*2+1]);//put diags on canvasref
//compare();//show strip/ref colour diffs now in loaded()
//tagmatch();

// =====================end of javascript mainline code================================


</script>
</html>

