<!DOCTYPE html>
<!-- 19/12/2023 mouse coordinates with reference to canvas position
     redraws canvas with 0,0 as canvas 0,0
     mousemoved() offsets wrong.
-->

<html >

<head>
  <title> canvas relative mouse coords ></title>
</head>

<style>
div.r {position: absolute; top: 40px; left:200px;}
div.pic {position: absolute; top: 0px; left:0px}
</style>

<body>
<div class="pic" onWheel="zoom(event)" onmousedown="drawpixelated(event)" onmouseup="drawpixelated(event)" onmousemove="mousemoved(event)" >
<br>
<img id="image" class="pic" src="900x900.png" width="300px" onclick="drawpixelated()">
<br>move canvas with text<br>
<canvas id="Canvas" width="300px" height="300px" ></canvas>


<script>
mag=1;
size=1;
document.getElementById("image").onWheel="drawpixelated(event)";
 canvas = document.getElementById("Canvas");
 ctx = canvas.getContext("2d");
img=document.getElementById("image");
ctx.drawImage(img,0,0,300,300);
imgData = ctx.getImageData(0,0,300,300);
console.log("imgData.data[0] "+imgData.data[0]);
// get/put for pixelation. get single pixel, draw as 10x10 matrix
  console.log("trying pixelation at start");
  ctx.fillStyle="#FF00FF";ctx.fillRect(0,0,40,40);
  for(x=0;x<10;x++)for(y=0;y<10;y++){
     pixel=ctx.getImageData(x,y,1,1);
    for(mx=0;mx<200;mx++)for(my=0;my<200;my++)ctx.putImageData(pixel,x+mx,y+my);
  }


//mouse coordinates relative to canvas origin 

function getMousePos(canvas, evt) {
    var rect = canvas.getBoundingClientRect();
    return {
      x: evt.clientX - rect.left,
      y: evt.clientY - rect.top
    };
  }
  canvas.addEventListener('mousemove', function(evt) {
    var mousePos = getMousePos(canvas, evt);
//    console.log('Mouse position: ' + mousePos.x + ',' + mousePos.y);
//    ctx.drawImage(img,mousePos.x,mousePos.y,300,300);
  }, false);

function drawpixelated(){
console.log("drawpixelated invoked event.button="+event.button);

if(event.button==0){  //left mouse click
 px=3;
 part=30;
 for(x=0;x<900/part;x++)for(y=0;y<900/part;y++)
  { 
   ctx.drawImage(img,event.clientX,event.clientY,300,300);
// console.log("pixels x,y to px,px "+x+y);
  }
 }
// get/put for pixelation. get single pixel, draw as 10x10 matrix
 canvasp = document.getElementById("Canvas");
 ctxp = canvasp.getContext("2d");
 img=document.getElementById("image");
 imgDatap = ctxp.getImageData(0,0,90,90);
 ctxp.drawImage(img,100,100);
  for(x=0;x<10;x++)for(y=0;y<10;y++){
     pixel=ctxp.getImageData(x,y,1,1);
     for(mx=0;mx<10;mx++)for(my=0;my<10;my++)ctxp.putImageData(pixel,x+mx,y+my);
  }
}

function zoom(event){

size+=event.deltaY/4;
console.log("zoom invoked "+event.deltaY+" size="+size);
}
function mousemoved(){
   scale=300/size;
   offsetx=-event.clientX/scale;
   offsety=-event.clientY/scale;
   ctx.drawImage(img,offsetx,offsety,size,size);
}

</script>
</html>